<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>耗材目录重新修改</title>
    <link rel="stylesheet" href="../../lib/layui-v2.6.3/css/layui.css">
    <link rel="stylesheet" href="../../css/public.css">
    <script src="../../lib/jquery-3.4.1/jquery-3.4.1.min.js"></script>
    <script src="../../lib/layui-v2.6.3/layui.js"></script>
<body>

<div class="layui-body-header">
    <span class="layui-body-header-title"></span>
</div>

<div class="layui-fluid " style="">
    <div class="layui-card">
        <div class="layui-card-body">
            <form id="consumableslistForm" lay-filter="consumableslistForm" class="layui-form model-form"
                  style="max-width: 700px;margin:auto;">
                <input name="id" type="hidden"/>
                <div class="layui-form-item">
                    <label class="layui-form-label">实训项目名称<span style="color: red;">*</span></label>
                    <div class="layui-input-block">
                        <input id="training" name="training" type="text" class="layui-input" lay-verify="required"
                               lay-reqtext="实训项目名称不能为空" required/>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">耗材名称<span style="color: red;">*</span></label>
                    <div class="layui-input-block">
                        <input id="name" name="name" placeholder="请输入耗材名称" type="text" class="layui-input"
                               lay-verify="required" lay-reqtext="耗材名称不能为空" required/>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">型号规格及主要<span style="color: red;">*</span></label>
                    <div class="layui-input-block">
                        <input id="standards" name="standards" placeholder="请输入型号规格及主要" type="text"
                               class="layui-input" lay-verify="required" lay-reqtext="耗材规格不能为空" required/>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">耗材属性<span style="color: red;">*</span></label>
                    <div class="layui-input-block">
                        <select id="attribute" name="attribute" lay-verify="required" lay-reqtext="耗材属性不能为空">
                            <option value="">请选择耗材属性</option>
                            <option value="1">低值易耗品</option>
                            <option value="2">低值耐用品</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">耗材类别<span style="color: red;">*</span></label>
                    <div class="layui-input-block">
                        <select name="type" id="type" lay-verify="required" lay-reqtext="耗材类别不能为空">
                            <option value="">请选择耗材类别</option>
                            <option value="1">酒店食品</option>
                            <option value="2">金属材料</option>
                            <option value="3">电子电器</option>
                            <option value="4">建筑材料</option>
                            <option value="5">服装服饰</option>
                            <option value="6">文化绘画</option>
                            <option value="7">工具仪表</option>
                            <option value="8">化工药品</option>
                            <option value="9">气体类</option>
                            <option value="10">维修保养</option>
                            <option value="11">其他</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">二级学院<span style="color: red;">*</span></label>
                    <div class="layui-input-block">
                        <select id="department" name="department" lay-verify="required" lay-reqtext="学院不能为空"
                                required disabled>>
                            <option value="">部门</option>
                            <option value="智慧学院">智慧学院</option>
                            <option value="机电学院">机电学院</option>
                            <option value="艺术学院">艺术学院</option>
                            <option value="康养学院">康养学院</option>
                            <option value="建筑学院">建筑学院</option>
                            <option value="旅游学院">旅游学院</option>
                            <option value="交通学院">交通学院</option>
                            <option value="经贸学院">经贸学院</option>
                            <option value="教育学院">教育学院</option>
                            <option value="酒店学院">酒店学院</option>
                            <option value="电商学院">电商学院</option>
                            <option value="国际学院">国际学院</option>
                            <option value="海大航海学院">海大航海学院</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">单位<span style="color: red;">*</span></label>
                    <div class="layui-input-block">
                        <input id="unit" name="unit" placeholder="请输入单位" type="text" class="layui-input"
                               lay-verify="required" lay-reqtext="单位不能为空" required/>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">耗材单价（元）<span style="color: red;">*</span></label>
                    <div class="layui-input-block">
                        <input id="price" name="price" placeholder="请输入耗材单价（元）" type="text" class="layui-input"
                               lay-verify="required|number" lay-reqtext="单价不能为空" required/>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">生均数量<span style="color: red;">*</span></label>
                    <div class="layui-input-block">
                        <input id="number" name="number" placeholder="请输入生均数量" type="text" class="layui-input"
                               lay-verify="required|number" lay-reqtext="生均数量不能为空" required/>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn" lay-filter="btnSubmit" lay-submit>&emsp;重新提交审核&emsp;</button>
                        <button class="layui-btn layui-btn-primary" type="button" id="backupPage">&emsp;返回&emsp;
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

</body>

<script>
    layui.use(['form'], function () {
        var layer = layui.layer //弹层
            , form = layui.form
            , $ = layui.jquery
        //修改数据后台查询渲染

        var idselect = layui.sessionData('editId').id
        var sendData = {"id": idselect};
        let review_id;
        $.ajax({
            type: "post",
            url: "/consumableslist/selectUpdateData?id=" + idselect,
            data: "",
            contentType: "application/json",
            datatype: "json",
            success: function (msg) {
                review_id = msg.data.review_id
                console.log(msg.data)
                let attribute, type, training;
                if (msg.data.attribute == "低值易耗品") {
                    attribute = "1";
                }
                if (msg.data.attribute == "低值耐用品") {
                    attribute = "2";
                }
                switch (msg.data.type) {
                    case "酒店食品":
                        type = "1";
                        break;
                    case "金属材料":
                        type = "2";
                        break;
                    case "电子电器":
                        type = "3";
                        break;
                    case "建筑材料":
                        type = "4";
                        break;
                    case "服装服饰":
                        type = "5";
                        break;
                    case "文化绘画":
                        type = "6";
                        break;
                    case "工具仪表":
                        type = "7";
                        break;
                    case "化工药品":
                        type = "8";
                        break;
                    case "气体类":
                        type = "9";
                        break;
                    case "维修保养":
                        type = "10";
                        break;
                    case "其他":
                        type = "11";
                        break;
                    default:
                        type = "";
                }

                form.val("consumableslistForm", {
                    'name': msg.data.name,
                    'standards': msg.data.standards,
                    'attribute': attribute,
                    'type': type,
                    'department': msg.data.department,
                    'unit': msg.data.unit,
                    'price': msg.data.price,
                    'number': msg.data.number,
                    'training': msg.data.training
                });
                $("#department").attr("disabled", "disabled");
                $("#training").attr("disabled", "disabled");
            },
            error: function (msg) {
                layer.msg("失败");
            }
        })


        form.on('submit(btnSubmit)', function (data) {
            layer.confirm('点击提交将会重新进入审核队列,确定提交吗？', {
                btn: ['确定','取消']
            }, function(){
                //表单提交事件
                var id = layui.sessionData('editId').id
                var sendData = {
                    "id": id,
                    "review_id": review_id,
                    "training": $("#training").val(),
                    "name": $("#name").val(),
                    "standards": $("#standards").val(),
                    "attribute": $("#attribute").val(),
                    "department": $("#department").val(),
                    "unit": $("#unit").val(),
                    "type": $("#type").val(),
                    "price": $("#price").val(),
                    "number": $("#number").val(),
                }
                $.ajax({
                    type: "post",
                    url: "/consumableslist/modifyConsumablesList",
                    data: sendData,
                    datatype: "json",
                    success: function (msg) {
                        if (msg.status == "1") {
                            // layer.msg("修改成功");
                            var iframeIndex = parent.layer.getFrameIndex(window.name);
                            parent.layer.msg('已重新提交审核', {icon: 6, time: 3000, anim: 6})
                            parent.layer.close(iframeIndex);
                        } else {
                            layer.msg(msg.message);
                        }
                    }
                });
            }, function(){
                return false;
            });
            return false;
        })

        $("#backupPage").click(function () {
            parent.layer.close(parent.layer.index);
        })

    });

    //获取url参数值
    function getQueryValue(queryName) {
        var reg = new RegExp("(^|&)" + queryName + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) {
            return decodeURI(r[2]);
        } else {
            return null;
        }
    }
</script>
</html>